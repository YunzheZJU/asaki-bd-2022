<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>あさき生誕祭2022</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
<div id="asaki-bd-2022" style="opacity: 0"></div>
</body>
<script>
  const GLOBAL_BEGIN = 20
  const shouldForceRatio = true
  const shouldDisableRotate = true
  const RED = 'var(--red)'
  const BLUE = 'var(--blue)'
  const YELLOW = 'var(--yellow)'
  const GREEN = 'var(--green)'
  const PURPLE = 'var(--purple)'
  const BLACK = 'var(--black)'
  const WHITE = 'var(--white)'
  const FADE_IN = 'opacity_from_0_to_1'
  const FADE_OUT = 'opacity_from_1_to_0'
  const APP = document.querySelector('#asaki-bd-2022')
</script>
<script src="lib/ratio.js"></script>
<script src="lib/pre.js"></script>
<script src="scenes/s0.js"></script>
<script src="scenes/s1.js"></script>
<script src="scenes/s2.js"></script>
<script src="scenes/s3.js"></script>
<script src="scenes/s4.js"></script>
<script>
  APP.innerHTML += `
<div class="s5">
  <div class="bg">
    <div style="background: var(--purple)"></div>
    <div style="background: var(--red)"></div>
    <div style="background: var(--blue)"></div>
    <div style="background: var(--yellow)"></div>
  </div>
  <div class="text-box" style="color: var(--black); writing-mode: vertical-lr; font-weight: normal;">
    <div class="center" style="padding: 18rem 12rem; font-size: 13rem; color: var(--white); writing-mode: horizontal-tb; font-weight: bold; letter-spacing: 1rem">
      <span class="relative">涙</span>
      <span class="relative" style="margin-left: 2.5rem">が</span>
    </div>
    <div class="bottom" style="padding: 6rem 12rem; transform-style: preserve-3d; perspective: 90rem">
      <span class="relative" style="font-size: 4.5rem; position: relative">　　君　　</span>
    </div>
    <div class="left" style="padding: 6rem 12rem;">
      <span>君</span>
      <span>が</span>
      <span>い</span>
      <span>た</span>
      <span>か</span>
      <span>ら</span>
    </div>
    <div class="right" style="padding: 6rem 12rem;">
      <span>　</span>
      <span>嬉</span>
      <span>し</span>
      <span>く</span>
      <span>て</span>
      <span>　</span>
    </div>
  </div>
  <div class="ray">
    <div class="bottom">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
    <div class="left">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
    <div class="right">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
  <div class="frame" style="font-family: Lyra, serif; font-size: 2.25rem; color: var(--white);">
    <div class="chapter-ja relative">第１章</div>
    <div class="chapter-en relative" style="letter-spacing: 0.5rem">Chapter 1</div>
  </div>
  <div class="mask"></div>
</div>
`

  const s5_begin = s4_end + 0.15
  s`.s5 .bg`.align(TOP, BOTTOM, LEFT, RIGHT)
  s`.s5 .bg div`.align(TOP, BOTTOM, LEFT, RIGHT).origin(index => [isEven(index) ? LEFT : RIGHT, BOTTOM])
                .animate(index => ([`rotate_from_${isEven(index) ? '-90' : '90'}deg_to_0deg`, { begin: s5_begin + index * 0.1, dur: 0.5 + index * 0.05, fill: 'both' }, 's5_bg_in']))
  s`.s5 .frame`.align(4, 4, 4, 4)
               .animate(FADE_IN, { begin: a.s5_bg_in.end - 0.1, dur: 0.2, fill: 'both' }, 's5_frame_in')
               .after.align({ [BOTTOM]: -3.2, [RIGHT]: -3.2 }).size(0, 0).stroke('transparent', 3.2).rotate(-45).css({ 'border-top-color': 'var(--white)' })
  s`.s5 .frame .chapter-ja`.align(LEFT, TOP)
  s`.s5 .frame .chapter-en`.align(RIGHT, TOP)
  s`.s5 .text-box`.align(TOP, BOTTOM, LEFT, RIGHT).align_children(CENTER, CENTER)
  s`.s5 .text-box .bottom`.align(BOTTOM).css({ overflow: 'hidden' })
                          .animate(FADE_IN, { begin: a.s5_bg_in.end - 0.05, dur: 0, fill: 'both' }, 's5_text_box_bottom_in')
                          .before.align(TOP, BOTTOM, LEFT, RIGHT).fill(WHITE).translate_z(-20).scale(1.3, 1.3)
                          .after.align(TOP, BOTTOM, LEFT, RIGHT).fill(YELLOW).origin(RIGHT, CENTER).translate_x('1p').scale(1.02, 1.02)
                          .animate('rotate_y_from_0deg_to_-100deg', { begin: a.s5_text_box_bottom_in.begin, dur: 0.6, fill: 'both', easing: 'cubic-bezier(0, 0.55, 0.45, 1)' }, 's5_text_box_bottom_rotate')
  s`.s5 .text-box .bottom`.animate(FADE_OUT, { begin: a.s5_text_box_bottom_rotate.end, dur: 0, fill: 'forwards' }, 's5_text_box_bottom_out')
  s`.s5 .ray`.align(TOP, BOTTOM, LEFT, RIGHT).align_children(CENTER, CENTER)
  s`.s5 .ray .bottom`.align().size(25, 25).round().translate_y(14).align_children(CENTER, CENTER)
  s`.s5 .ray .bottom span`.align().size(0.5, 14).round().origin(CENTER, BOTTOM).translate_y('-50p').rotate(index => index * 60).css({ overflow: 'hidden' })
                          .animate(FADE_IN, { begin: a.s5_text_box_bottom_out.end, dur: 0, fill: 'both' }, 's5_ray_bottom_in')
                          .forEach(ele => ele.before.size(1, 3.2).fill(WHITE).animate('translate_y_from_10rem_to_-4rem', { begin: a.s5_ray_bottom_in.end - 0.2, dur: 0.8, fill: 'both', easing: 'ease' }, 's5_ray_bottom_out'))
  s`.s5 .mask`.align(TOP, BOTTOM, LEFT, RIGHT).fill(PURPLE).origin(RIGHT, TOP)
              .animate('rotate_from_90deg_to_0deg', { begin: a.s5_ray_bottom_out.end - 0.3, dur: 0.3, fill: 'both', easing: 'cubic-bezier(0, 0.55, 0.45, 1)' }, 's5_mask_rotate_1')
              .animate({ origin: [[RIGHT, TOP], [RIGHT, BOTTOM]] }, { begin: a.s5_mask_rotate_1.end, dur: 0, fill: 'forwards' })
              .animate('rotate_from_0deg_to_-90deg', { begin: a.s5_mask_rotate_1.end + 0.2, dur: 0.3, fill: 'forwards', easing: 'cubic-bezier(0.55, 0, 1, 0.45)' }, 's5_mask_rotate_2')
  s`.s5 .text-box .left`.align(LEFT).fill(WHITE)
                        .animate(FADE_IN, { begin: a.s5_mask_rotate_1.end, dur: 0, fill: 'both' }, 's5_text_box_left_in')
  s`.s5 .text-box .left span`.animate('translate_y_from_-10p_to_0p', { begin: a.s5_text_box_left_in.begin, dur: 1.2, easing: '>', fill: 'both' })
  s`.s5 .ray .left`.align().size(25, 25).round().translate(-30, -18).align_children(CENTER, CENTER)
  s`.s5 .ray .left span`.align().size(0.5, 14).round().origin(CENTER, BOTTOM).translate_y('-50p').rotate(index => index * 60).css({ overflow: 'hidden' })
                        .animate(FADE_IN, { begin: a.s5_mask_rotate_2.begin + 0.3, dur: 0, fill: 'both' }, 's5_ray_left_in')
                        .forEach(ele => ele.before.size(1, 4).fill(WHITE).animate('translate_y_from_10rem_to_-5rem', { begin: a.s5_ray_left_in.end - 0.2, dur: 1, fill: 'both', easing: 'ease' }, 's5_ray_left_out'))
  s`.s5 .mask`.animate([{ origin: [RIGHT, BOTTOM] }, { origin: [LEFT, TOP] }], { begin: a.s5_mask_rotate_2.end, dur: 0, fill: 'forwards' })
              .animate('rotate_from_-90deg_to_0deg', { begin: a.s5_mask_rotate_2.end + 0.3, dur: 0.3, fill: 'forwards', easing: 'cubic-bezier(0, 0.55, 0.45, 1)' }, 's5_mask_rotate_3')
              .animate({ origin: [[LEFT, TOP], [LEFT, BOTTOM]] }, { begin: a.s5_mask_rotate_3.end, dur: 0, fill: 'forwards' })
              .animate('rotate_from_0deg_to_90deg', { begin: a.s5_mask_rotate_3.end + 0.2, dur: 0.3, fill: 'forwards', easing: 'cubic-bezier(0.55, 0, 1, 0.45)' }, 's5_mask_rotate_4')
  s`.s5 .text-box .right`.align(RIGHT).fill(WHITE)
                         .animate(FADE_IN, { begin: a.s5_mask_rotate_3.end, dur: 0, fill: 'both' }, 's5_text_box_right_in')
  s`.s5 .text-box .right span`.animate('translate_y_from_-10p_to_0p', { begin: a.s5_text_box_right_in.begin, dur: 0.8, easing: '>', fill: 'both' })
  s`.s5 .ray .right`.align().size(25, 25).round().translate(30, 18).align_children(CENTER, CENTER)
  s`.s5 .ray .right span`.align().size(0.5, 14).round().origin(CENTER, BOTTOM).translate_y('-50p').rotate(index => index * 60).css({ overflow: 'hidden' })
                         .animate(FADE_IN, { begin: a.s5_mask_rotate_4.begin + 0.3, dur: 0, fill: 'both' }, 's5_ray_right_in')
                         .forEach(ele => ele.before.size(1, 4).fill(WHITE).animate('translate_y_from_10rem_to_-5rem', { begin: a.s5_ray_right_in.end - 0.2, dur: 1, fill: 'both', easing: 'ease' }, 's5_ray_right_out'))
  const s5_bg_replace_begin = a.s5_mask_rotate_3.end
  const s5_text_box_center_scale_begin = a.s5_ray_right_out.end - 0.6
  s`.s5 .frame`.animate(FADE_OUT, { begin: s5_bg_replace_begin, dur: 0, fill: 'forwards' })
  s`.s5 .bg div`.animate(FADE_OUT, { begin: s5_bg_replace_begin, dur: 0, fill: 'both' })
  s`.s5 .bg`.animate({ fill: ['transparent', WHITE] }, { begin: s5_bg_replace_begin, dur: 0, fill: 'both' })
            .before.align(TOP, LEFT).fill(YELLOW)
            .animate(FADE_IN, { begin: s5_bg_replace_begin, dur: 0, fill: 'both' })
            .animate('size_from_100p_15rem_to_100p_8rem', { begin: s5_text_box_center_scale_begin, dur: 0.6, fill: 'both' })
            .after.align(BOTTOM, LEFT).size({ height: 15 }).fill(YELLOW)
            .animate(FADE_IN, { begin: s5_bg_replace_begin, dur: 0, fill: 'both' })
            .animate('size_from_100p_15rem_to_100p_8rem', { begin: s5_text_box_center_scale_begin, dur: 0.6, fill: 'both' })
  s`.s5 .text-box .center`.animate(FADE_IN, { begin: s5_bg_replace_begin, dur: 0, fill: 'both' })
                          .before.align(TOP, BOTTOM, LEFT, RIGHT).fill(YELLOW).css({ filter: 'blur(2rem)', 'border-radius': '10rem' })
                          .animate({ scale: [[1.5, 1.5], [0.9, 0.9]] }, { begin: s5_text_box_center_scale_begin - 0.1, dur: 0.8, fill: 'both' }, 's5_text_box_center_scale')
  s`.s5 .text-box .left span`.animate(index => ([[{ opacity: 1, translate: [0, 0] }, { opacity: 0, translate: [-3.5 + index * 0.2, -1 + index * 0] }], { begin: s5_text_box_center_scale_begin - 0.1 + index * 0.02, dur: 0.5, fill: 'both', easing: '<' }, 's5_text_box_left_span_out']))
  s`.s5 .text-box .right span`.animate(index => ([[{ opacity: 1, translate: [0, 0] }, { opacity: 0, translate: [4 - index * 0.3, 1 + index * 0] }], { begin: s5_text_box_center_scale_begin - 0 + index * 0.02, dur: 0.5, fill: 'both', easing: '<' }, 's5_text_box_right_span_out']))
  s`.s5 .text-box .center span`
                               .animate(index => [[{ scale: [3, 3], opacity: 0 }, { scale: [1, 1], opacity: 1 }], { begin: a.s5_text_box_center_scale.end - 0.25 + 0.15 * index, dur: 0.3, fill: 'both', easing: 'cubic-bezier(0.33, 1, 0.68, 1)' }])
</script>
<script>
  APP.style.opacity = 1
  window.addEventListener('dblclick', () => location.reload())
</script>
<script src="lib/post.js"></script>
</html>
