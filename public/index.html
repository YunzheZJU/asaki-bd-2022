<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>あさき生誕祭2022</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
<div id="asaki-bd-2022" style="opacity: 0"></div>
</body>
<script>
  const GLOBAL_BEGIN = 16
  const shouldForceRatio = true
  const shouldDisableRotate = true
  const RED = 'var(--red)'
  const BLUE = 'var(--blue)'
  const YELLOW = 'var(--yellow)'
  const GREEN = 'var(--green)'
  const PURPLE = 'var(--purple)'
  const BLACK = 'var(--black)'
  const WHITE = 'var(--white)'
  const FADE_IN = 'opacity_from_0_to_1'
  const FADE_OUT = 'opacity_from_1_to_0'
  const APP = document.querySelector('#asaki-bd-2022')
</script>
<script src="lib/ratio.js"></script>
<script src="lib/pre.js"></script>
<script src="scenes/s0.js"></script>
<script src="scenes/s1.js"></script>
<script src="scenes/s2.js"></script>
<script src="scenes/s3.js"></script>
<script src="scenes/s4.js"></script>
<script>
  APP.innerHTML += `
<div class="s5">
  <div class="bg">
    <div style="background: var(--purple)"></div>
    <div style="background: var(--red)"></div>
    <div style="background: var(--blue)"></div>
    <div style="background: var(--yellow)"></div>
  </div>
  <div class="text-box" style="color: var(--black); writing-mode: vertical-lr; font-weight: normal;">
    <div class="bottom" style="padding: 4rem 12rem; transform-style: preserve-3d; perspective: 90rem">
      <span style="position:relative; font-size: 4.5rem">　　君　　　</span>
    </div>
    <div class="left" style="padding: 6rem 12rem;">
      <span style="position:relative;">君がいたから</span>
    </div>
    <div class="right" style="padding: 6rem 12rem;">
      <span style="position:relative;">　嬉しくて　</span>
    </div>
  </div>
  <div class="frame" style="font-family: Lyra, serif; font-size: 2.25rem; color: var(--white);">
    <div class="chapter-ja">第１章</div>
    <div class="chapter-en" style="letter-spacing: 0.5rem">Chapter 1</div>
  </div>
  <div class="mask"></div>
</div>
`

  const s5_begin = s4_end + 0.15
  s`.s5 .bg`.align(TOP, BOTTOM, LEFT, RIGHT)
  s`.s5 .bg div`.align(TOP, BOTTOM, LEFT, RIGHT).origin(index => [isEven(index) ? LEFT : RIGHT, BOTTOM])
                .animate(index => ([`rotate_from_${isEven(index) ? '-90' : '90'}deg_to_0deg`, { begin: s5_begin + index * 0.1, dur: 0.5 + index * 0.05, fill: 'both' }, 's5_bg_in']))
  s`.s5 .frame`.align(4, 4, 4, 4)
               .animate(FADE_IN, { begin: a.s5_bg_in.end - 0.1, dur: 0.2, fill: 'both' }, 's5_frame_in')
               .after.align({ [BOTTOM]: -3.2, [RIGHT]: -3.2 }).size(0, 0).stroke('transparent', 3.2).rotate(-45).css({ 'border-top-color': 'var(--white)' })
  s`.s5 .frame .chapter-ja`.align(LEFT, TOP)
  s`.s5 .frame .chapter-en`.align(RIGHT, TOP)
  s`.s5 .text-box`.align(TOP, BOTTOM, LEFT, RIGHT).align_children(CENTER, CENTER)
  s`.s5 .text-box .bottom`.align(BOTTOM).css({ overflow: 'hidden' })
                          .animate(FADE_IN, { begin: a.s5_bg_in.end - 0.05, dur: 0, fill: 'both' }, 's5_text_box_bottom_in')
                          .before.align(TOP, BOTTOM, LEFT, RIGHT).fill(WHITE).translate_z(-20).scale(1.3, 1.3)
                          .after.align(TOP, BOTTOM, LEFT, RIGHT).fill(YELLOW).origin(RIGHT, CENTER).translate_x('1p').scale(1.02, 1.02)
                          .animate('rotate_y_from_0deg_to_-100deg', { begin: a.s5_text_box_bottom_in.begin, dur: 0.6, fill: 'both', easing: 'cubic-bezier(0, 0.55, 0.45, 1)' }, 's5_text_box_bottom_rotate')
  // 文字消失时留下放射线
  s`.s5 .mask`.align(TOP, BOTTOM, LEFT, RIGHT).fill(PURPLE).origin(RIGHT, TOP)
              .animate('rotate_from_90deg_to_0deg', { begin: a.s5_text_box_bottom_rotate.end, dur: 0.3, fill: 'both', easing: 'cubic-bezier(0, 0.55, 0.45, 1)' }, 's5_mask_rotate_1')
              .animate({ origin: [[RIGHT, TOP], [RIGHT, BOTTOM]] }, { begin: a.s5_mask_rotate_1.end, dur: 0, fill: 'forwards' })
              .animate('rotate_from_0deg_to_-90deg', { begin: a.s5_mask_rotate_1.end + 0.2, dur: 0.3, fill: 'forwards', easing: 'cubic-bezier(0.55, 0, 1, 0.45)' }, 's5_mask_rotate_2')
  s`.s5 .text-box .bottom`.animate(FADE_OUT, { begin: a.s5_mask_rotate_1.end, dur: 0, fill: 'forwards' }, 's5_text_box_bottom_out')
  s`.s5 .text-box .left`.align(LEFT).css({ overflow: 'hidden' }).fill(WHITE)
                        .animate(FADE_IN, { begin: a.s5_text_box_bottom_out.begin, dur: 0, fill: 'both' }, 's5_text_box_left_in')
  s`.s5 .text-box .left span`.animate('translate_y_from_-10p_to_0p', { begin: a.s5_text_box_left_in.begin, dur: 1.2, easing: '>', fill: 'both' })
  s`.s5 .mask`.animate([{ origin: [RIGHT, BOTTOM] }, { origin: [LEFT, TOP] }], { begin: a.s5_mask_rotate_2.end, dur: 0, fill: 'forwards' })
              .animate('rotate_from_-90deg_to_0deg', { begin: a.s5_mask_rotate_2.end + 0.3, dur: 0.3, fill: 'forwards', easing: 'cubic-bezier(0, 0.55, 0.45, 1)' }, 's5_mask_rotate_3')
              .animate({ origin: [[LEFT, TOP], [LEFT, BOTTOM]] }, { begin: a.s5_mask_rotate_3.end, dur: 0, fill: 'forwards' })
              .animate('rotate_from_0deg_to_90deg', { begin: a.s5_mask_rotate_3.end + 0.2, dur: 0.3, fill: 'forwards', easing: 'cubic-bezier(0.55, 0, 1, 0.45)' }, 's5_mask_rotate_4')
  s`.s5 .text-box .right`.align(RIGHT).css({ overflow: 'hidden' }).fill(WHITE)
                         .animate(FADE_IN, { begin: a.s5_mask_rotate_3.end, dur: 0, fill: 'both' }, 's5_text_box_right_in')
  s`.s5 .text-box .right span`.animate('translate_y_from_-10p_to_0p', { begin: a.s5_text_box_right_in.begin, dur: 0.8, easing: '>', fill: 'both' })
</script>
<script>
  APP.style.opacity = 1
  window.addEventListener('dblclick', () => location.reload())
</script>
<script src="lib/post.js"></script>
</html>
